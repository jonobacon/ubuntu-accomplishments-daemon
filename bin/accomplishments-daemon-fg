#!/usr/bin/twistd -noy
"""
Run the Accomplishments daemon!
"""
import sys
import os

from twisted.internet import glib2reactor
glib2reactor.install()

import dbus
from dbus.mainloop.glib import DBusGMainLoop

from accomplishments.daemon import app

from accomplishments.util import paths

if paths.runs_in_branch:
    # PYTHONPATH mangling
    sys.path.insert(0, ".")

dbus_loop = DBusGMainLoop(set_as_default=True)
application = app.applicationFactory(
    app_name="Ubuntu Accomplishments",
    bus_name="org.ubuntu.accomplishments",
    main_loop=dbus_loop,
    session_bus=dbus.SessionBus(mainloop=dbus_loop),
    object_path="/",
    # Let's execute the timer service every 15 minutes
    update_interval=15 * 60,
    gpg_key=os.path.join(paths.systemdata_dir, "validation-key.pub"))
